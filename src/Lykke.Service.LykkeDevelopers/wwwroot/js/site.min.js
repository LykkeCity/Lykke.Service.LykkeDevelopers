function getCookie(n){var t,i;return document.cookie.length>0&&(t=document.cookie.indexOf(n+"="),t!==-1)?(t=t+n.length+1,i=document.cookie.indexOf(";",t),i===-1&&(i=document.cookie.length),decodeURIComponent(document.cookie.substring(t,i))):""}function getAntiForgeryCookie(){return getCookie("XSRF-TOKEN")}$(function(){$("body").prepend('<div class="message" style="display:none"><span>X<\/span><div class="txt"><\/div><div class="controls"><\/div><\/div>');$.hideMessage=function(){clearTimeout($.messageTimer);$(".message").fadeOut(400)};$.showMessage=function(n,t,i){var r=$(".message"),e,u,o,f;for(r.removeClass("success"),r.removeClass("error"),r.addClass(n),r.find(".txt").text(t),r.find("span").click($.hideMessage),e=r.find(".controls"),e.empty(),$.showMessageActions=[],u=0;u<i.length;u++)o=i[u],f=$('<a href="javascript:;">'+o.text+"<\/a>"),f.attr("no",u),$.showMessageActions.push(o.action),f.click(function(){$.hideMessage();$.showMessageActions[$(this).attr("no")]()}),e.append(f);clearTimeout($.messageTimer);$.messageTimer=setTimeout($.hideMessage,5e3);r.fadeIn(400)};$.unlockJson=function(n){return getCookie("username")?(deleteCookie("username"),typeof n=="function"?$.post($.unlockJsonUrl,n):$.post($.unlockJsonUrl),!0):!0};$.forceUnlockJson=function(n){return getCookie("username")&&deleteCookie("username"),typeof n=="function"?$.post($.unlockJsonUrl,n):$.post($.unlockJsonUrl),!0}});var Request=function(){function n(){}return n.reloadAction={reloadPage:!1,div:"",url:"",data:{},showLoading:!1},n.doRequest=function(n){if(!n.url)throw"url is empty";n.params=n.formId?$(n.formId).serialize():n.params;this.setUpdateInfo(n);n.onStart&&n.onStart();this.blockOnRequest();this.peformRequest(n)},n.setUpdateInfo=function(n){this.reloadAction.reloadPage=!1;this.reloadAction.div=n.divResult;this.reloadAction.url=n.requestUrl;this.reloadAction.data=n.requestParams;this.reloadAction.showLoading=n.showLoading},n.peformRequest=function(n){var t=this,i;n.onShowLoading?n.onShowLoading():n.showLoading!==!1&&n.divResult&&($(n.divResult).html('<div style="text-align:center; margin-top:20px;"><img src="/images/loading.gif"><\/div>'),$(n.divResult).show());i={url:n.url,type:"POST",data:n.params,headers:{RequestVerificationToken:getAntiForgeryCookie()}};$.ajax(i).then(function(i){n.onHideLoading&&n.onHideLoading();n.onFinish&&n.onFinish();t.unBlockOnRequest();t.requestOkHandler(n,i)}).fail(function(i){n.onHideLoading&&n.onHideLoading();n.onFinish&&n.onFinish();t.unBlockOnRequest();t.requestFailHandle(n,i.responseText,i)})},n.requestOkHandler=function(n,t){var i=this;if(t.status==="ErrorValidation"){$(".error").removeClass("error");t.field&&$(t.field).addClass("error");return}if(t.status==="ErrorMessage"){t.field&&$(t.field).text(t.msg);return}if(t.status==="Fail"){t.divError&&(n.divError=t.divError);n.placement=t.placement;this.requestFailHandle(n,t.msg);return}if(t.status==="Reload"){this.reloadAction.reloadPage?location.reload():this.doRequest({url:this.reloadAction.url,params:this.reloadAction.data,divResult:this.reloadAction.div,showLoading:this.reloadAction.showLoading});return}if(t.refreshUrl){this.doRequest({url:t.refreshUrl,params:t.prms,divResult:t.div,showLoading:t.showLoading});return}if(t.inputId){$(t.inputId).val(t.text);return}n.divResult&&(n.replaceDiv?$(n.divResult).replaceWith(t):$(n.divResult).html(t))},n.requestFailHandle=function(n,t,i){i&&i.status===403?n.divResult&&$(n.divResult).html('<div class="alert alert-danger" style="text-align:center; margin-top:20px;"><h1>Access denied<\/h1>You don\'t have an access to visit the '+n.url+" page.<\/div>"):$.showMessage("error",t,[{text:"Ok",action:function(){}}])},n.blockOnRequest=function(){$(".disableOnRequest").each(function(){$(this).attr("disabled","true")});$(".hideOnRequest").each(function(){$(this).css("display","none")});$(".showOnRequest").each(function(){$(this).css("display","inline")})},n.unBlockOnRequest=function(){$(".disableOnRequest").each(function(){$(this).removeAttr("disabled")});$(".hideOnRequest").each(function(){$(this).css("display","inline")});$(".showOnRequest").each(function(){$(this).css("display","none")})},n}();